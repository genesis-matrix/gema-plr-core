##
## Salt Master Aggregate Configuration
##



##_META:
##  Contents:
##    - fileserver_backend
##    - pillar_roots
##    - file_roots
##    - gitfs_remotes
##



# File Server Backend
fileserver_backend:
  - roots
  - git



# (testing) required by openscap execution module but not generally recommended
#file_recv: True



# pillar_roots
## - A base environment is required to house the top.sls file
## - the environment precedence/workflow is as follows:
## lab -> dev -> stg -> uat -> prod
## - this supports maintaining multiple versions of the same config in the
## same cfg-store, safely, for testing, without impacting more
## promoted a/o stable versions used by downstream environments.
## - For example, a UAT state will never be pulled into production, but in
## order to maintain a UAT environment, based in production, with
## only intended alteration, all the production states are available
## unless overidden.
pillar_roots:
  base:
    - /srv/salt/pillar/base.sitelocal
    - /srv/salt/pillar/base.core



# ext_pillar
ext_pillar_first: False
ext_pillar:
  # (ex.) GeMa Core PLR
  # - git: master:base https://github.com/genesis-matrix/gema-plr-core.git
  # - git:
  #   - master https://github.com/genesis-matrix/gema-plr-core:
  #     - env: base
  - nodegroups:
      pillar_name: "nodegroups"
  - file_tree:
      root_dir: /srv/salt/pillar.sitelocal/base/assets/static
      follow_dir_links: True
      keep_newline: True
  # - gitstack: 
  #     branch: master
  #     repo: https://github.com/genesis-matrix/gema-plr-core
  #     stack:
  #       - pillarstack.cfg
  #       - pillarstack.cfg
  #       - pillarstack.cfg
  #       - pillarstack.cfg
  - stack:
    - /srv/salt/pillar/base.core/pillarstack.cfg
    - /srv/salt/pillar/base.core/pillarstack.cfg
    - /srv/salt/pillar/base.core/pillarstack.cfg
    - /srv/salt/pillar/base.core/pillarstack.cfg
  #ref: https://github.com/saltstack/salt/issues/39501
  #- consul: consul-00-loopback root=salt/pillar/_shared/
  #- consul: consul-00-loopback root=salt/pillar/_nodegroup/%(nodegroup)s
  #howto, (ex.) add consul state in consul,
  #  /salt/pillar/_hosts/salt-master-d1/lookup/sls_path/:
  #    ['state.machine.service.consul']
  #- consul: consul-00-loopback root=salt/pillar/_hosts/%(minion_id)s



# file_roots
## - A base environment is required to house the top.sls file
## - the environment precedence/workflow is as follows:
## LAB -> DEV -> STG -> UAT -> prod 
## - this supports maintaining multiple versions of the same config in the
## same cfg-store, safely, for testing, without impacting more
## promoted a/o stable versions used by downstream environments.
## - For example, a UAT state will never be pulled into production, but in
## order to maintain a UAT environment, based in production, with
## only intended alteration, all the production states are available
## unless overidden.
file_roots:
  base:
    - /srv/salt/roots/base.sitelocal
    - /srv/salt/roots/base.core
  VESTIBULE:
    - /srv/salt/roots/vestibule.sitelocal
    - /srv/salt/roots/vestibule.contrib



#
file_ignore_regex:
  - /\.svn($|/)
  - ^\.git($|/)



# gitfs_remotes
## NOTES:
##  - https://docs.saltstack.com/en/latest/topics/tutorials/gitfs.html
##  - Per-remote configuration parameters are named like the global versions, with the gitfs_ removed from the beginning.
##  - salt-run fileserver.clear_cache backend=git
##  - salt-run fileserver.file_list saltenv=dev backend=git
##  - salt-run fileserver.update backend=roots,git
##  - salt.fileserver.gitfs.envs(ignore_cache=False) #Return a list of refs that can be used as environments
gitfs_remotes:
  # (ex.) GeMa Core SLS
  # - https://github.com/genesis-matrix/gema-sls-core:
  #   - base: master
  # Gitstack Pillar module
  # - https://github.com/amendlik/gitstack-pillar.git
  # Saltstack configured Saltstack
  - https://github.com/saltstack-formulas/salt-formula:
    - base: master
  # openstack/salt-formula-kubernetes
  - https://github.com/salt-formulas/salt-formula-kubernetes:
    - base: master
  # Hubblestack components
  - https://github.com/hubblestack/hubble-salt:
    - base: v2017.11.0



## EOF
